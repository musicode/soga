function e(e){const o={};return(e.getAllResponseHeaders()||"").replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(e,t,n){return o[t.toLowerCase()]=n,e}),function(e,o){return function t(){return{ok:e.status>=200&&e.status<300,statusText:e.statusText||"OK",status:e.status||200,url:e.responseURL||o["x-request-url"]||"",headers:{get:e=>o[e.toLowerCase()],has:e=>e.toLowerCase()in o},body:e.response||e.responseText,text:()=>e.responseText,json:()=>JSON.parse(e.responseText),blob:()=>new Blob([e.response]),clone:t}}}(e,o)}function o(e,o){for(let t in o)e.setRequestHeader(t,o[t])}function t(e){const o=typeof e;return"string"===o?encodeURIComponent(e):"undefined"!==o?""+e:void 0}function n(n,s={}){return new Promise(function(i,r){const a=new XMLHttpRequest,l=s.method?s.method.toLowerCase():"get";let c=s.body||null;if(s.data){let e=function(e){const o=[];for(let n in e){let s=e[n];if(Array.isArray(s))for(let e=0,i=s.length;e<i;e++){let i=t(s[e]);"string"==typeof i&&o.push(n+"[]="+i)}else"string"==typeof(s=t(s))&&o.push(n+"="+s)}return o.join("&")}(s.data);e&&("get"===l?n+="?"+e:c||(c=e))}a.open(l,n,!0),a.onload=function(){const o=e(a);i(o())},a.onerror=r,"include"===s.credentials?a.withCredentials=!0:"omit"===s.credentials&&(a.withCredentials=!1),o(a,s.headers),a.send(c)})}class s{static support(){const e=new XMLHttpRequest;return"upload"in e&&"onprogress"in e.upload}constructor(o,t){const n=this;n.file=o,n.hooks=t,n.fileSize=o.size||0;const s=n.xhr=new XMLHttpRequest;s.onloadstart=function(){t.onStart&&t.onStart()},s.onloadend=function(){t.onEnd&&t.onEnd()},s.onload=function(){const{fileSize:o,chunkInfo:i}=n;if(i&&i.uploaded<o&&(i.uploaded+=i.uploading,t.onChunkSuccess&&t.onChunkSuccess({chunkIndex:i.options.chunkIndex}),i.uploaded<o))return i.options.chunkIndex++,void n.uploadChunk(i.options);if(t.onSuccess){const o=e(s);t.onSuccess(o())}},s.onerror=function(){t.onError&&t.onError()},s.onabort=function(){t.onAbort&&t.onAbort()},s.upload.onprogress=function(e){const{fileSize:o,chunkInfo:s}=n;let i;if(s){const o=s.uploading,n=Math.min(o,e.loaded);t.onChunkProgress&&t.onChunkProgress({chunkIndex:s.options.chunkIndex,uploaded:n,total:o,percent:o>0?n/o:0}),i=s.uploaded+n}else i=Math.min(o,e.loaded);t.onProgress&&t.onProgress({uploaded:i,total:o,percent:o>0?i/o:0})}}upload(e){const{xhr:t,file:n}=this;t.open("post",e.action,!0),"include"===e.credentials?t.withCredentials=!0:"omit"===e.credentials&&(t.withCredentials=!1);const s=new FormData;for(let o in e.data)s.append(o,e.data[o]);s.append(e.fileName,n),o(t,e.headers),t.send(s)}uploadChunk(e){let{xhr:t,file:n,fileSize:s,chunkInfo:i}=this;i?i.options!==e&&(i.options=e):i=this.chunkInfo={uploaded:0,uploading:0,options:e};const r=e.chunkIndex||0,a=e.chunkSize||4194304,l=a*r,c=Math.min(s,a*(r+1));i.uploading=c-l,t.open("post",e.action,!0);const d={Range:`bytes ${l}-${c}/${s}`};for(let o in e.headers)d[o]=e.headers[o];o(t,d);const u=File.prototype.slice||File.prototype.webkitSlice||File.prototype.mozSlice;t.send(u.call(n,l,c))}abort(){this.xhr.abort()}destroy(){this.abort()}}class i{constructor(e,o={}){const t=r+a++,n=function(e,o,t){const n=document.createElement("div");return n.innerHTML='<object id="'+e+'" class="'+r.toLowerCase()+'" type="application/x-shockwave-flash" data="'+o+'"><param name="movie" value="'+o+'" /><param name="allowscriptaccess" value="always" /><param name="wmode" value="transparent" /><param name="flashvars" value="'+t+'" /></object>',n.children[0]}(t,e.swfUrl,function(e,o,t){return["projectName="+r,"movieName="+e,"accept="+encodeURIComponent(o),"multiple="+(t?"true":"false")].join("&amp;")}(t,e.accept||"",e.multiple||!1)),{el:s}=e;if(!s.parentNode)throw new Error("el.parentNode is not found.");s.parentNode.replaceChild(n,s),this.swf=n,this.movieName=t,this.hooks=o,this.debug=!!e.debug,i.instances[t]=this}getFiles(){return this.swf.getFiles()}upload(e,o){this.swf.upload(e,o.action,o.fileName,o.data,o.headers)}abort(e){this.swf.abort(e)}enable(){this.swf.enable()}disable(){this.swf.disable()}destroy(){const e=this.getFiles();for(let o=0,t=e.length;o<t;o++)this.abort(e[o].index);this.swf.destroy(),i.instances[this.movieName]=null,window[this.movieName]=null}onReady(){const{onReady:e}=this.hooks;e&&e()}onFileChange(){const{onFileChange:e}=this.hooks;e&&e()}onStart(e){const{onStart:o}=this.hooks;o&&o(e.file)}onEnd(e){const{onEnd:o}=this.hooks;o&&o(e.file)}onError(e){const{onError:o}=this.hooks;o&&o(e.file,e.code,e.detail)}onAbort(e){const{onAbort:o}=this.hooks;o&&o(e.file)}onProgress(e){const{onProgress:o}=this.hooks;if(o){const{file:t,uploaded:n,total:s}=e;o(t,{uploaded:n,total:s,percent:s>0?n/s:0})}}onSuccess(e){const{onSuccess:o}=this.hooks;o&&o(e.file,e.responseText)}onDebug(e){this.debug&&console.log(e.text)}}i.instances={},i.STATUS_WAITING=0,i.STATUS_UPLOADING=1,i.STATUS_UPLOAD_SUCCESS=2,i.STATUS_UPLOAD_ERROR=3,i.STATUS_UPLOAD_ABORT=4,i.ERROR_SECURITY=0,i.ERROR_IO=1;const r="Soga_Flash_Uploader";window[r]=i;let a=0;export{s as AjaxUploader,i as FlashUploader,n as fetch};
//# sourceMappingURL=soga.esm.min.js.map
