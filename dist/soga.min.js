!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?o(exports):"function"==typeof define&&define.amd?define(["exports"],o):o((e=e||self).Soga={})}(this,function(e){"use strict";function o(e){var o={};return(e.getAllResponseHeaders()||"").replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(e,t,n){return o[t.toLowerCase()]=n,e}),function(e,o){return function t(){return{ok:e.status>=200&&e.status<300,statusText:e.statusText||"OK",status:e.status||200,url:e.responseURL||o["x-request-url"]||"",headers:{get:function(e){return o[e.toLowerCase()]},has:function(e){return e.toLowerCase()in o}},body:e.response||e.responseText,text:function(){return e.responseText},json:function(){return JSON.parse(e.responseText)},blob:function(){return new Blob([e.response])},clone:t}}}(e,o)}function t(e,o){for(var t in o)e.setRequestHeader(t,o[t])}var n=File.prototype.slice||File.prototype.webkitSlice||File.prototype.mozSlice,r=function(e,t){var n=this;n.file=e,n.hooks=t,n.fileSize=e.size||0;var r=n.xhr=new XMLHttpRequest;r.onloadstart=function(){t.onStart&&t.onStart()},r.onloadend=function(){t.onEnd&&t.onEnd()},r.onload=function(){var e=n.fileSize,s=n.chunkInfo;if(s&&s.uploaded<e&&(s.uploaded+=s.uploading,t.onChunkSuccess&&t.onChunkSuccess({chunkIndex:s.options.chunkIndex}),s.uploaded<e))return s.options.chunkIndex++,void n.uploadChunk(s.options);if(t.onSuccess){var i=o(r);t.onSuccess(i())}},r.onerror=function(){t.onError&&t.onError()},r.onabort=function(){t.onAbort&&t.onAbort()},r.upload.onprogress=function(e){var o,r=n.fileSize,s=n.chunkInfo;if(s){var i=s.uploading,a=Math.min(i,e.loaded);t.onChunkProgress&&t.onChunkProgress({chunkIndex:s.options.chunkIndex,uploaded:a,total:i,percent:i>0?a/i:0}),o=s.uploaded+a}else o=Math.min(r,e.loaded);t.onProgress&&t.onProgress({uploaded:o,total:r,percent:r>0?o/r:0})}};r.support=function(){var e=new XMLHttpRequest;return"upload"in e&&"onprogress"in e.upload},r.prototype.upload=function(e){var o=this.xhr,n=this.file;o.open("post",e.action,!0),"include"===e.credentials?o.withCredentials=!0:"omit"===e.credentials&&(o.withCredentials=!1);var r=new FormData;for(var s in e.data)r.append(s,e.data[s]);r.append(e.fileName,n),t(o,e.headers),o.send(r)},r.prototype.uploadChunk=function(e){var o=this.xhr,r=this.file,s=this.fileSize,i=this.chunkInfo;i?i.options!==e&&(i.options=e):i=this.chunkInfo={uploaded:0,uploading:0,options:e};var a=e.chunkIndex||0,u=e.chunkSize||4194304,p=u*a,l=Math.min(s,u*(a+1));i.uploading=l-p,o.open("post",e.action,!0);var d={Range:"bytes "+p+"-"+l+"/"+s};for(var c in e.headers)d[c]=e.headers[c];t(o,d),o.send(n.call(r,p,l))},r.prototype.abort=function(){this.xhr.abort()},r.prototype.destroy=function(){this.abort()};var s=function e(o,t){void 0===t&&(t={});var n,r,s,u,p=i+a++,l=(n=p,r=o.swfUrl,s=function(e,o,t){return["projectName="+i,"movieName="+e,"accept="+encodeURIComponent(o),"multiple="+(t?"true":"false")].join("&amp;")}(p,o.accept||"",o.multiple||!1),(u=document.createElement("div")).innerHTML='<object id="'+n+'" class="'+i.toLowerCase()+'" type="application/x-shockwave-flash" data="'+r+'"><param name="movie" value="'+r+'" /><param name="allowscriptaccess" value="always" /><param name="wmode" value="transparent" /><param name="flashvars" value="'+s+'" /></object>',u.children[0]),d=o.el;if(!d.parentNode)throw new Error("el.parentNode is not found.");d.parentNode.replaceChild(l,d),this.swf=l,this.movieName=p,this.hooks=t,this.debug=!!o.debug,e.instances[p]=this};s.prototype.getFiles=function(){return this.swf.getFiles()},s.prototype.upload=function(e,o){this.swf.upload(e,o.action,o.fileName,o.data,o.headers)},s.prototype.abort=function(e){this.swf.abort(e)},s.prototype.enable=function(){this.swf.enable()},s.prototype.disable=function(){this.swf.disable()},s.prototype.destroy=function(){for(var e=this.getFiles(),o=0,t=e.length;o<t;o++)this.abort(e[o].index);this.swf.destroy(),s.instances[this.movieName]=null,window[this.movieName]=null},s.prototype.onReady=function(){var e=this.hooks.onReady;e&&e()},s.prototype.onFileChange=function(){var e=this.hooks.onFileChange;e&&e()},s.prototype.onStart=function(e){var o=this.hooks.onStart;o&&o(e.file)},s.prototype.onEnd=function(e){var o=this.hooks.onEnd;o&&o(e.file)},s.prototype.onError=function(e){var o=this.hooks.onError;o&&o(e.file,e.code,e.detail)},s.prototype.onAbort=function(e){var o=this.hooks.onAbort;o&&o(e.file)},s.prototype.onProgress=function(e){var o=this.hooks.onProgress;if(o){var t=e.file,n=e.uploaded,r=e.total;o(t,{uploaded:n,total:r,percent:r>0?n/r:0})}},s.prototype.onSuccess=function(e){var o=this.hooks.onSuccess;o&&o(e.file,e.responseText)},s.prototype.onDebug=function(e){this.debug&&console.log(e.text)},s.instances={},s.STATUS_WAITING=0,s.STATUS_UPLOADING=1,s.STATUS_UPLOAD_SUCCESS=2,s.STATUS_UPLOAD_ERROR=3,s.STATUS_UPLOAD_ABORT=4,s.ERROR_SECURITY=0,s.ERROR_IO=1;var i="Soga_Flash_Uploader";window[i]=s;var a=0;e.AjaxUploader=r,e.FlashUploader=s,e.fetch=function(e,n){return void 0===n&&(n={}),new Promise(function(r,s){var i=new XMLHttpRequest;i.open(n.method||"get",e,!0),i.onload=function(){var e=o(i);r(e())},i.onerror=s,"include"===n.credentials?i.withCredentials=!0:"omit"===n.credentials&&(i.withCredentials=!1),t(i,n.headers),i.send(n.body||null)})},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=soga.min.js.map
