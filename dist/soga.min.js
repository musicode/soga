!function(o,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((o=o||self).Soga={})}(this,function(o){"use strict";function e(o){var e={};return(o.getAllResponseHeaders()||"").replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(o,t,n){return e[t.toLowerCase()]=n,o}),function(o,e){return function t(){return{ok:o.status>=200&&o.status<300,statusText:o.statusText||"OK",status:o.status||200,url:o.responseURL||e["x-request-url"]||"",headers:{get:function(o){return e[o.toLowerCase()]},has:function(o){return o.toLowerCase()in e}},body:o.response||o.responseText,text:function(){return o.responseText},json:function(){return JSON.parse(o.responseText)},blob:function(){return new Blob([o.response])},clone:t}}}(o,e)}function t(o,e){for(var t in e)o.setRequestHeader(t,e[t])}var n=File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice,r=function(o,t){var n=this;n.file=o,n.hooks=t,n.fileSize=o.size||0;var r=n.xhr=new XMLHttpRequest;r.onloadstart=function(){t.onStart&&t.onStart()},r.onloadend=function(){t.onEnd&&t.onEnd()},r.onload=function(){var o=n.fileSize,s=n.chunkInfo;if(s&&s.uploaded<o&&(s.uploaded+=s.uploading,t.onChunkSuccess&&t.onChunkSuccess({chunkIndex:s.options.chunkIndex}),s.uploaded<o))return s.options.chunkIndex++,void n.uploadChunk(s.options);if(t.onSuccess){var a=e(r);t.onSuccess(a())}},r.onerror=function(){t.onError&&t.onError()},r.onabort=function(){t.onAbort&&t.onAbort()},r.upload.onprogress=function(o){var e,r=n.fileSize,s=n.chunkInfo;if(s){var a=s.uploading,i=Math.min(a,o.loaded);t.onChunkProgress&&t.onChunkProgress({chunkIndex:s.options.chunkIndex,uploaded:i,total:a,percent:a>0?i/a:0}),e=s.uploaded+i}else e=Math.min(r,o.loaded);t.onProgress&&t.onProgress({uploaded:e,total:r,percent:r>0?e/r:0})}};r.support=function(){var o=new XMLHttpRequest;return o&&"upload"in o&&"onprogress"in o.upload},r.prototype.upload=function(o){var e=this.xhr,n=this.file;e.open("post",o.action,!0);var r=new FormData;for(var s in o.data)r.append(s,o.data[s]);r.append(o.fileName,n),t(e,o.headers),e.send(r)},r.prototype.uploadChunk=function(o){var e=this.xhr,r=this.file,s=this.fileSize,a=this.chunkInfo;a?a.options!==o&&(a.options=o):a=this.chunkInfo={uploaded:0,uploading:0,options:o};var i=o.chunkIndex||0,u=o.chunkSize||4194304,p=u*i,l=Math.min(s,u*(i+1));a.uploading=l-p,e.open("post",o.action,!0);var d={Range:"bytes "+p+"-"+l+"/"+s};for(var c in o.headers)d[c]=o.headers[c];t(e,d),e.send(n.call(r,p,l))},r.prototype.abort=function(){this.xhr.abort()},r.prototype.destroy=function(){this.abort()};var s=function o(e,t){void 0===t&&(t={});var n,r,s,u,p=a+i++,l=(n=p,r=e.swfUrl,s=function(o,e,t){return["projectName="+a,"movieName="+o,"accept="+encodeURIComponent(e),"multiple="+(t?"true":"false")].join("&amp;")}(p,e.accept||"",e.multiple||!1),(u=document.createElement("div")).innerHTML='<object id="'+n+'" class="'+a.toLowerCase()+'" type="application/x-shockwave-flash" data="'+r+'"><param name="movie" value="'+r+'" /><param name="allowscriptaccess" value="always" /><param name="wmode" value="transparent" /><param name="flashvars" value="'+s+'" /></object>',u.children[0]),d=e.el;if(!d.parentNode)throw new Error("el.parentNode is not found.");d.parentNode.replaceChild(l,d),this.swf=l,this.movieName=p,this.hooks=t,this.debug=!!e.debug,o.instances[p]=this};s.prototype.getFiles=function(){return this.swf.getFiles()},s.prototype.upload=function(o,e){this.swf.upload(o,e.action,e.fileName,e.data,e.headers)},s.prototype.abort=function(o){this.swf.abort(o)},s.prototype.enable=function(){this.swf.enable()},s.prototype.disable=function(){this.swf.disable()},s.prototype.destroy=function(){for(var o=this.getFiles(),e=0,t=o.length;e<t;e++)this.abort(o[e].index);this.swf.destroy(),s.instances[this.movieName]=null,window[this.movieName]=null},s.prototype.onReady=function(){var o=this.hooks.onReady;o&&o()},s.prototype.onFileChange=function(){var o=this.hooks.onFileChange;o&&o()},s.prototype.onStart=function(o){var e=this.hooks.onStart;e&&e(o.file)},s.prototype.onEnd=function(o){var e=this.hooks.onEnd;e&&e(o.file)},s.prototype.onError=function(o){var e=this.hooks.onError;e&&e(o.file,o.code,o.detail)},s.prototype.onAbort=function(o){var e=this.hooks.onAbort;e&&e(o.file)},s.prototype.onProgress=function(o){var e=this.hooks.onProgress;if(e){var t=o.file,n=o.uploaded,r=o.total;e(t,{uploaded:n,total:r,percent:r>0?n/r:0})}},s.prototype.onSuccess=function(o){var e=this.hooks.onSuccess;e&&e(o.file,o.responseText)},s.prototype.onDebug=function(o){this.debug&&console.log(o.text)},s.instances={},s.STATUS_WAITING=0,s.STATUS_UPLOADING=1,s.STATUS_UPLOAD_SUCCESS=2,s.STATUS_UPLOAD_ERROR=3,s.STATUS_UPLOAD_ABORT=4,s.ERROR_SECURITY=0,s.ERROR_IO=1;var a="Soga_Flash_Uploader";window[a]=s;var i=0;o.AjaxUploader=r,o.FlashUploader=s,o.fetch=function(o,n){return void 0===n&&(n={}),new Promise(function(r,s){var a=new XMLHttpRequest;a.open(n.method||"get",o,!0),a.onload=function(){var o=e(a);r(o())},a.onerror=s,"include"===n.credentials?a.withCredentials=!0:"omit"===n.credentials&&(a.withCredentials=!1),t(a,n.headers),a.send(n.body||null)})},Object.defineProperty(o,"__esModule",{value:!0})});
//# sourceMappingURL=soga.min.js.map
