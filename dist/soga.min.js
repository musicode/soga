!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e=e||self).Soga={})}(this,function(e){"use strict";function n(e){var n={};return(e.getAllResponseHeaders()||"").replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(e,o,t){return n[o.toLowerCase()]=t,e}),function(e,n){return function o(){return{ok:e.status>=200&&e.status<300,statusText:e.statusText||"OK",status:e.status||200,url:e.responseURL||n["x-request-url"]||"",headers:{get:function(e){return n[e.toLowerCase()]},has:function(e){return e.toLowerCase()in n}},body:e.response||e.responseText,text:function(){return e.responseText},json:function(){return JSON.parse(e.responseText)},blob:function(){return new Blob([e.response])},clone:o}}}(e,n)}function o(e,n){for(var o in n)e.setRequestHeader(o,n[o])}var t=File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice,r=function(e,o){var t=this;t.file=e,t.hooks=o,t.fileSize=e.size||0;var r=t.xhr=new XMLHttpRequest;r.onloadstart=function(){o.onStart&&o.onStart()},r.onloadend=function(){o.onEnd&&o.onEnd()},r.onload=function(){var e=t.fileSize,s=t.chunkInfo;if(s&&s.uploaded<e&&(s.uploaded+=s.uploading,o.onChunkSuccess&&o.onChunkSuccess({chunkIndex:s.options.chunkIndex}),s.uploaded<e))return s.options.chunkIndex++,void t.uploadChunk(s.options);if(o.onSuccess){var i=n(r);o.onSuccess(i())}},r.onerror=function(){o.onError&&o.onError()},r.onabort=function(){o.onAbort&&o.onAbort()},r.upload.onprogress=function(e){var n,r=t.fileSize,s=t.chunkInfo;if(s){var i=s.uploading,u=Math.min(i,e.loaded);o.onChunkProgress&&o.onChunkProgress({chunkIndex:s.options.chunkIndex,uploaded:u,total:i,percent:i>0?u/i:0}),n=s.uploaded+u}else n=Math.min(r,e.loaded);o.onProgress&&o.onProgress({uploaded:n,total:r,percent:r>0?n/r:0})}};r.support=function(){var e=new XMLHttpRequest;return e&&"upload"in e&&"onprogress"in e.upload},r.prototype.upload=function(e){var n=this.xhr,t=this.file;n.open("post",e.action,!0);var r=new FormData;for(var s in e.data)r.append(s,e.data[s]);r.append(e.fileName,t),o(n,e.headers),n.send(r)},r.prototype.uploadChunk=function(e){var n=this.xhr,r=this.file,s=this.fileSize,i=this.chunkInfo;i?i.options!==e&&(i.options=e):i=this.chunkInfo={uploaded:0,uploading:0,options:e};var u=e.chunkIndex||0,a=e.chunkSize||4194304,d=a*u,p=Math.min(s,a*(u+1));i.uploading=p-d,n.open("post",e.action,!0);var c={Range:"bytes "+d+"-"+p+"/"+s};for(var l in e.headers)c[l]=e.headers[l];o(n,c),n.send(t.call(r,d,p))},r.prototype.abort=function(){this.xhr.abort()},e.AjaxUploader=r,e.fetch=function(e,t){return void 0===t&&(t={}),new Promise(function(r,s){var i=new XMLHttpRequest;i.open(t.method||"get",e,!0),i.onload=function(){var e=n(i);r(e())},i.onerror=s,"include"===t.credentials?i.withCredentials=!0:"omit"===t.credentials&&(i.withCredentials=!1),o(i,t.headers),i.send(t.body||null)})},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=soga.min.js.map
