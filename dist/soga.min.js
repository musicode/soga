!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?o(exports):"function"==typeof define&&define.amd?define(["exports"],o):o((e=e||self).Soga={})}(this,function(e){"use strict";function o(e){var o={};return(e.getAllResponseHeaders()||"").replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(e,t,n){return o[t.toLowerCase()]=n,e}),function(e,o){return function t(){return{ok:e.status>=200&&e.status<300,statusText:e.statusText||"OK",status:e.status||200,url:e.responseURL||o["x-request-url"]||"",headers:{get:function(e){return o[e.toLowerCase()]},has:function(e){return e.toLowerCase()in o}},body:e.response||e.responseText,text:function(){return e.responseText},json:function(){return JSON.parse(e.responseText)},blob:function(){return new Blob([e.response])},clone:t}}}(e,o)}function t(e,o){for(var t in o)e.setRequestHeader(t,o[t])}function n(e){var o=typeof e;return"string"===o?encodeURIComponent(e):"undefined"!==o?""+e:void 0}var r=function(e,t){var n=this;n.file=e,n.hooks=t,n.fileSize=e.size||0;var r=n.xhr=new XMLHttpRequest;r.onloadstart=function(){t.onStart&&t.onStart()},r.onloadend=function(){t.onEnd&&t.onEnd()},r.onload=function(){var e=n.fileSize,a=n.chunkInfo;if(a&&a.uploaded<e&&(a.uploaded+=a.uploading,t.onChunkSuccess&&t.onChunkSuccess({chunkIndex:a.options.chunkIndex}),a.uploaded<e))return a.options.chunkIndex++,void n.uploadChunk(a.options);if(t.onSuccess){var i=o(r);t.onSuccess(i())}},r.onerror=function(){t.onError&&t.onError()},r.onabort=function(){t.onAbort&&t.onAbort()},r.upload.onprogress=function(e){var o,r=n.fileSize,a=n.chunkInfo;if(a){var i=a.uploading,s=Math.min(i,e.loaded);t.onChunkProgress&&t.onChunkProgress({chunkIndex:a.options.chunkIndex,uploaded:s,total:i,percent:i>0?s/i:0}),o=a.uploaded+s}else o=Math.min(r,e.loaded);t.onProgress&&t.onProgress({uploaded:o,total:r,percent:r>0?o/r:0})}};r.support=function(){var e=new XMLHttpRequest;return"upload"in e&&"onprogress"in e.upload},r.prototype.upload=function(e){var o=this.xhr,n=this.file;o.open("post",e.action,!0),"include"===e.credentials?o.withCredentials=!0:"omit"===e.credentials&&(o.withCredentials=!1);var r=new FormData;for(var a in e.data)r.append(a,e.data[a]);r.append(e.fileName,n),t(o,e.headers),o.send(r)},r.prototype.uploadChunk=function(e){var o=this.xhr,n=this.file,r=this.fileSize,a=this.chunkInfo;a?a.options!==e&&(a.options=e):a=this.chunkInfo={uploaded:0,uploading:0,options:e};var i=e.chunkIndex||0,s=e.chunkSize||4194304,u=s*i,p=Math.min(r,s*(i+1));a.uploading=p-u,o.open("post",e.action,!0);var d={Range:"bytes "+u+"-"+p+"/"+r};for(var l in e.headers)d[l]=e.headers[l];t(o,d);var c=File.prototype.slice||File.prototype.webkitSlice||File.prototype.mozSlice;o.send(c.call(n,u,p))},r.prototype.abort=function(){this.xhr.abort()},r.prototype.destroy=function(){this.abort()};var a=function(e,o){void 0===o&&(o={});var t,n,r,u,p=i+s++,d=(t=p,n=e.swfUrl,r=function(e,o,t){return["projectName="+i,"movieName="+e,"accept="+encodeURIComponent(o),"multiple="+(t?"true":"false")].join("&amp;")}(p,e.accept||"",e.multiple||!1),(u=document.createElement("div")).innerHTML='<object id="'+t+'" class="'+i.toLowerCase()+'" type="application/x-shockwave-flash" data="'+n+'"><param name="movie" value="'+n+'" /><param name="allowscriptaccess" value="always" /><param name="wmode" value="transparent" /><param name="flashvars" value="'+r+'" /></object>',u.children[0]),l=e.el;if(!l.parentNode)throw new Error("el.parentNode is not found.");l.parentNode.replaceChild(d,l),this.swf=d,this.movieName=p,this.hooks=o,this.debug=!!e.debug,a.instances[p]=this};a.prototype.getFiles=function(){return this.swf.getFiles()},a.prototype.upload=function(e,o){this.swf.upload(e,o.action,o.fileName,o.data,o.headers)},a.prototype.abort=function(e){this.swf.abort(e)},a.prototype.enable=function(){this.swf.enable()},a.prototype.disable=function(){this.swf.disable()},a.prototype.destroy=function(){for(var e=this.getFiles(),o=0,t=e.length;o<t;o++)this.abort(e[o].index);this.swf.destroy(),a.instances[this.movieName]=null,window[this.movieName]=null},a.prototype.onReady=function(){var e=this.hooks.onReady;e&&e()},a.prototype.onFileChange=function(){var e=this.hooks.onFileChange;e&&e()},a.prototype.onStart=function(e){var o=this.hooks.onStart;o&&o(e.file)},a.prototype.onEnd=function(e){var o=this.hooks.onEnd;o&&o(e.file)},a.prototype.onError=function(e){var o=this.hooks.onError;o&&o(e.file,e.code,e.detail)},a.prototype.onAbort=function(e){var o=this.hooks.onAbort;o&&o(e.file)},a.prototype.onProgress=function(e){var o=this.hooks.onProgress;if(o){var t=e.file,n=e.uploaded,r=e.total;o(t,{uploaded:n,total:r,percent:r>0?n/r:0})}},a.prototype.onSuccess=function(e){var o=this.hooks.onSuccess;o&&o(e.file,e.responseText)},a.prototype.onDebug=function(e){this.debug&&console.log(e.text)},a.instances={},a.STATUS_WAITING=0,a.STATUS_UPLOADING=1,a.STATUS_UPLOAD_SUCCESS=2,a.STATUS_UPLOAD_ERROR=3,a.STATUS_UPLOAD_ABORT=4,a.ERROR_SECURITY=0,a.ERROR_IO=1;var i="Soga_Flash_Uploader";window[i]=a;var s=0;e.AjaxUploader=r,e.FlashUploader=a,e.fetch=function(e,r){return void 0===r&&(r={}),new Promise(function(a,i){var s=new XMLHttpRequest,u=r.method?r.method.toLowerCase():"get",p=r.headers,d=r.body||null;if(r.data){var l=function(e){var o=[];for(var t in e){var r=e[t];if(Array.isArray(r))for(var a=0,i=r.length;a<i;a++){var s=n(r[a]);"string"==typeof s&&o.push(t+"[]="+s)}else"string"==typeof(r=n(r))&&o.push(t+"="+r)}return o.join("&")}(r.data);l&&("get"===u?e+="?"+l:d||(d=l,p||(p={"content-type":"application/x-www-form-urlencoded"})))}s.open(u,e,!0),s.onload=function(){var e=o(s);a(e())},s.onerror=i,"include"===r.credentials?s.withCredentials=!0:"omit"===r.credentials&&(s.withCredentials=!1),t(s,p),s.send(d)})},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=soga.min.js.map
