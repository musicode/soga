!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((n=n||self).Soga={})}(this,function(n){"use strict";function e(n){var e=[],o=[],t=[];return n.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(n,r,a){return e.push(r=r.toLowerCase()),o.push(a),t.push([r,a]),n}),function(n,e,o,t){return function r(){return{ok:2==(n.status/100|0),statusText:n.statusText,status:n.status,url:n.responseURL,headers:{keys:function(){return e},values:function(){return o},entries:function(){return t}},text:function(){return n.responseText},json:function(){return JSON.parse(n.responseText)},blob:function(){return new Blob([n.response])},clone:r}}}(n,e,o,t)}function o(n,e){for(var o in e)n.setRequestHeader(o,e[o])}var t=File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice,r=function(n,o){var t=this;t.file=n,t.hooks=o,t.fileSize=n.size||0;var r=t.xhr=new XMLHttpRequest;r.onloadstart=function(){o.onUploadStart&&o.onUploadStart()},r.onloadend=function(){o.onUploadEnd&&o.onUploadEnd()},r.onload=function(){var n=t.fileSize,a=t.chunkInfo;if(a&&a.uploaded<n&&(a.uploaded+=a.uploading,o.onUploadChunkSuccess&&o.onUploadChunkSuccess({chunkIndex:a.options.chunkIndex}),a.uploaded<n))return a.options.chunkIndex++,void t.uploadChunk(a.options);if(o.onUploadSuccess){var u=e(r);o.onUploadSuccess(u())}},r.onerror=function(){o.onUploadError&&o.onUploadError()},r.onabort=function(){o.onUploadCancel&&o.onUploadCancel()},r.upload.onprogress=function(n){var e,r=t.fileSize,a=t.chunkInfo;if(a){var u=a.uploading,s=Math.min(u,n.loaded);o.onUploadChunkProgress&&o.onUploadChunkProgress({chunkIndex:a.options.chunkIndex,uploaded:s,total:u,percent:u>0?s/u:0}),e=a.uploaded+s}else e=Math.min(r,n.loaded);o.onUploadProgress&&o.onUploadProgress({uploaded:e,total:r,percent:r>0?e/r:0})}};r.support=function(){var n=new XMLHttpRequest;return n&&"upload"in n&&"onprogress"in n.upload},r.prototype.upload=function(n){var e=this.xhr,t=this.file;e.open("post",n.action,!0);var r=new FormData;for(var a in n.data)r.append(a,n.data[a]);r.append(n.fileName,t),o(e,n.headers),e.send(r)},r.prototype.uploadChunk=function(n){var e=this.xhr,r=this.file,a=this.fileSize,u=this.chunkInfo;u?u.options!==n&&(u.options=n):u=this.chunkInfo={uploaded:0,uploading:0,options:n};var s=n.chunkIndex||0,i=n.chunkSize||4194304,d=i*s,p=Math.min(a,i*(s+1));u.uploading=p-d,e.open("post",n.action,!0);var l={Range:"bytes "+d+"-"+p+"/"+a};for(var c in n.headers)l[c]=n.headers[c];o(e,l),e.send(t.call(r,d,p))},n.AjaxUploader=r,n.fetch=function(n,t){return void 0===t&&(t={}),new Promise(function(r,a){var u=new XMLHttpRequest;u.open(t.method||"get",n,!0),u.onload=function(){var n=e(u);r(n())},u.onerror=a,u.withCredentials="include"===t.credentials,o(u,t.headers),u.send(t.body||null)})},Object.defineProperty(n,"__esModule",{value:!0})});
//# sourceMappingURL=soga.min.js.map
