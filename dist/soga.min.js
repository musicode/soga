!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?o(exports):"function"==typeof define&&define.amd?define(["exports"],o):o((e=e||self).Soga={})}(this,function(e){"use strict";function o(e){var o={};return(e.getAllResponseHeaders()||"").replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(e,n,t){return o[n.toLowerCase()]=t,e}),function(e,o){return function n(){return{ok:e.status>=200&&e.status<300,statusText:e.statusText||"OK",status:e.status||200,url:e.responseURL||o["x-request-url"]||"",headers:{get:function(e){return o[e.toLowerCase()]},has:function(e){return e.toLowerCase()in o}},body:e.response||e.responseText,text:function(){return e.responseText},json:function(){return JSON.parse(e.responseText)},blob:function(){return new Blob([e.response])},clone:n}}}(e,o)}function n(e,o){for(var n in o)e.setRequestHeader(n,o[n])}var t=File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice,r=function(e,n){var t=this;t.file=e,t.hooks=n,t.fileSize=e.size||0;var r=t.xhr=new XMLHttpRequest;r.onloadstart=function(){n.onUploadStart&&n.onUploadStart()},r.onloadend=function(){n.onUploadEnd&&n.onUploadEnd()},r.onload=function(){var e=t.fileSize,a=t.chunkInfo;if(a&&a.uploaded<e&&(a.uploaded+=a.uploading,n.onUploadChunkSuccess&&n.onUploadChunkSuccess({chunkIndex:a.options.chunkIndex}),a.uploaded<e))return a.options.chunkIndex++,void t.uploadChunk(a.options);if(n.onUploadSuccess){var s=o(r);n.onUploadSuccess(s())}},r.onerror=function(){n.onUploadError&&n.onUploadError()},r.onabort=function(){n.onUploadCancel&&n.onUploadCancel()},r.upload.onprogress=function(e){var o,r=t.fileSize,a=t.chunkInfo;if(a){var s=a.uploading,i=Math.min(s,e.loaded);n.onUploadChunkProgress&&n.onUploadChunkProgress({chunkIndex:a.options.chunkIndex,uploaded:i,total:s,percent:s>0?i/s:0}),o=a.uploaded+i}else o=Math.min(r,e.loaded);n.onUploadProgress&&n.onUploadProgress({uploaded:o,total:r,percent:r>0?o/r:0})}};r.support=function(){var e=new XMLHttpRequest;return e&&"upload"in e&&"onprogress"in e.upload},r.prototype.upload=function(e){var o=this.xhr,t=this.file;o.open("post",e.action,!0);var r=new FormData;for(var a in e.data)r.append(a,e.data[a]);r.append(e.fileName,t),n(o,e.headers),o.send(r)},r.prototype.uploadChunk=function(e){var o=this.xhr,r=this.file,a=this.fileSize,s=this.chunkInfo;s?s.options!==e&&(s.options=e):s=this.chunkInfo={uploaded:0,uploading:0,options:e};var i=e.chunkIndex||0,u=e.chunkSize||4194304,d=u*i,p=Math.min(a,u*(i+1));s.uploading=p-d,o.open("post",e.action,!0);var l={Range:"bytes "+d+"-"+p+"/"+a};for(var c in e.headers)l[c]=e.headers[c];n(o,l),o.send(t.call(r,d,p))},r.prototype.abort=function(){this.xhr.abort()},e.AjaxUploader=r,e.fetch=function(e,t){return void 0===t&&(t={}),new Promise(function(r,a){var s=new XMLHttpRequest;s.open(t.method||"get",e,!0),s.onload=function(){var e=o(s);r(e())},s.onerror=a,"include"===t.credentials?s.withCredentials=!0:"omit"===t.credentials&&(s.withCredentials=!1),n(s,t.headers),s.send(t.body||null)})},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=soga.min.js.map
